<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Driver App</title>
</head>

<body>

<h2>Driver</h2>

<p id="status">Status: Online</p>

<div id="rideBox">Waiting for ride...</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io("http://localhost:3000");

const statusEl = document.getElementById("status");
const rideBox = document.getElementById("rideBox");

// tell server driver is online
socket.on("connect", () => {
  socket.emit("driver-online");
});

// receive new ride
socket.on("new-ride", (ride) => {
  if (ride.status !== "REQUESTED") return;

  rideBox.innerHTML = `
    <h3>New Ride</h3>
    <p>ğŸ“ Pickup: ${ride.pickup}</p>
    <p>ğŸ Drop: ${ride.drop}</p>
    <p>ğŸ’° Fare: â‚¹${ride.fare}</p>
    <button onclick="acceptRide()">Accept</button>
  `;
});

// ride state updates
socket.on("ride-update", (ride) => {
  if (ride.status === "ACCEPTED") {
    rideBox.innerHTML = `
      <p>Ride accepted</p>
      <button onclick="startRide()">Start Ride</button>
    `;
  }

  if (ride.status === "STARTED") {
    rideBox.innerHTML = `
      <p>Ride started</p>
      <button onclick="endRide()">End Ride</button>
    `;
  }

  if (ride.status === "COMPLETED") {
    rideBox.innerHTML = "Ride completed âœ…";
  }
});

function acceptRide(){
  socket.emit("accept-ride");
}

function startRide(){
  socket.emit("start-ride");
}

function endRide(){
  socket.emit("end-ride");
}
</script>

</body>
</html>
